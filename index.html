<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CKC Grand Master Points Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-section {
            padding: 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .search-box {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .search-input {
            padding: 15px 20px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            min-width: 400px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .search-btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            background: #34495e;
            border-bottom: 3px solid #2c3e50;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #34495e;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            border-right: 1px solid #2c3e50;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab:hover {
            background: #3498db;
        }

        .tab.active {
            background: #2c3e50;
            box-shadow: inset 0 3px 0 #e74c3c;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .status {
            display: none;
            padding: 30px;
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e6ed;
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .points-display {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }

        .points-display h3 {
            font-size: 1.4rem;
            margin-bottom: 10px;
        }

        .points-display .points-number {
            font-size: 3.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .title-progress {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .title-level {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .title-level:last-child {
            border-bottom: none;
        }

        .title-achieved {
            background: rgba(255,255,255,0.2);
            border-radius: 6px;
            padding: 4px 8px;
        }

        .title-current {
            background: #e74c3c;
            border-radius: 6px;
            padding: 4px 8px;
            font-weight: bold;
        }

        .yearly-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .year-card {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .year-card:hover {
            transform: translateY(-3px);
        }

        .year-card.selected {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 8px 20px rgba(231,76,60,0.3);
        }

        .year-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .year-card .year-points {
            font-size: 2rem;
            font-weight: bold;
        }

        .show-results {
            display: grid;
            gap: 15px;
        }

        .show-result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            transition: all 0.3s;
        }

        .show-result:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .show-result.points-earned {
            border-left: 5px solid #27ae60;
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
        }

        .show-result.no-points {
            border-left: 5px solid #6c757d;
        }

        .show-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .show-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            flex: 1;
        }

        .show-date {
            color: #666;
            font-size: 0.9rem;
            margin-left: 15px;
        }

        .show-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .detail-item {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .detail-label {
            font-weight: bold;
            color: #495057;
            display: block;
            font-size: 0.8rem;
            margin-bottom: 2px;
        }

        .points-calculation {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .calculation-formula {
            font-family: 'Courier New', monospace;
            background: rgba(255,255,255,0.1);
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 0.9rem;
        }

        .canuckdogs-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .canuckdogs-table th {
            background: #2c3e50;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-size: 0.9rem;
        }

        .canuckdogs-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.85rem;
        }

        .canuckdogs-table tr:hover {
            background: #f8f9fa;
        }

        .export-section {
            background: linear-gradient(135deg, #fd7e14, #e9630a);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-top: 30px;
        }

        .export-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin: 0 10px;
            transition: all 0.3s;
        }

        .export-btn:hover {
            background: white;
            color: #fd7e14;
        }

        .error {
            display: none;
            background: #e74c3c;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .dog-info {
            background: linear-gradient(135deg, #6f42c1, #563d7c);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .dog-info h3 {
            margin-bottom: 5px;
            font-size: 1.3rem;
        }

        .dog-info p {
            opacity: 0.9;
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .win-highlight {
            background: linear-gradient(135deg, #d4edda, #c3e6cb) !important;
        }

        .placement-highlight {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏆 CKC Grand Master Points Tracker</h1>
            <p>Extract CanuckDogs Data & Calculate Championship Points Automatically</p>
        </div>

        <div class="search-section">
            <h2>Enter Dog's Registered Name</h2>
            <div class="search-box">
                <input type="text" id="dogName" class="search-input" placeholder="Type the full registered name..." />
                <button onclick="extractAndCalculate()" id="extractBtn" class="search-btn">🔍 Extract & Calculate Points</button>
            </div>
        </div>

        <div id="status" class="status">
            <div class="spinner"></div>
            <p id="statusText">Extracting CanuckDogs data and calculating points...</p>
        </div>

        <div id="error" class="error">
            <p id="errorMessage"></p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">📊 Points Dashboard</button>
            <button class="tab" onclick="showTab('yearly')">📅 Year-by-Year Progress</button>
            <button class="tab" onclick="showTab('rawdata')">📋 CanuckDogs Raw Data</button>
            <button class="tab" onclick="showTab('reports')">📄 Export Reports</button>
        </div>

        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="card">
                    <div id="dogInfo" class="dog-info" style="display: none;">
                        <h3 id="dogTitle">Dog Name</h3>
                        <p id="dogDetails">Select a dog to view championship points</p>
                    </div>

                    <div class="points-display">
                        <h3>Total Grand Master Points</h3>
                        <div class="points-number" id="totalPoints">0</div>
                        <small>Lifetime Total</small>
                    </div>

                    <div class="title-progress">
                        <h3>🎖️ Title Progress</h3>
                        <div class="title-level">
                            <span>Champion (CH)</span>
                            <span id="chStatus" class="title-achieved">✓</span>
                        </div>
                        <div class="title-level">
                            <span>Grand Champion (GCH)</span>
                            <span id="gchStatus">20 pts needed</span>
                        </div>
                        <div class="title-level">
                            <span>Grand Champion Excellent (GCHX)</span>
                            <span id="gchxStatus">100 pts needed</span>
                        </div>
                        <div class="title-level">
                            <span>Grand Master (GM)</span>
                            <span id="gmStatus">200 pts needed</span>
                        </div>
                        <div class="title-level">
                            <span>Grand Master Supreme (GMS)</span>
                            <span id="gmsStatus">400 pts needed</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>🏆 Recent Show Results</h2>
                    <div id="recentResults">
                        <p style="text-align: center; color: #666; padding: 40px;">
                            Extract dog data to see championship point calculations
                        </p>
                    </div>
                </div>

                <div class="card">
                    <h2>📈 Points Summary</h2>
                    <div id="pointsSummary">
                        <div style="text-align: center; color: #666; padding: 40px;">
                            <p>Points breakdown will appear here after data extraction</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="yearly" class="tab-content">
            <div class="yearly-breakdown" id="yearlyBreakdown">
                <p style="text-align: center; color: #666; padding: 40px;">
                    Extract dog data to see year-by-year progression
                </p>
            </div>
            <div id="selectedYearDetails"></div>
        </div>

        <div id="rawdata" class="tab-content">
            <h2>📋 Raw CanuckDogs Competition Data</h2>
            <div id="rawDataTable">
                <p style="text-align: center; color: #666; padding: 40px;">
                    Extracted competition data will appear here
                </p>
            </div>
        </div>

        <div id="reports" class="tab-content">
            <div class="export-section">
                <h2>📊 Generate Championship Points Reports</h2>
                <p style="margin: 20px 0;">Generate comprehensive PDF reports with points calculations and supporting data</p>
                
                <button class="export-btn" onclick="generatePDFReport('complete')">
                    📄 Complete Championship Report
                </button>
                <button class="export-btn" onclick="generatePDFReport('yearly')">
                    📅 Year-by-Year Progress Report
                </button>
                <button class="export-btn" onclick="generatePDFReport('verification')">
                    ✅ Points Verification Report
                </button>
                
                <div style="margin-top: 30px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                    <h3>Report Contents:</h3>
                    <ul style="text-align: left; margin: 10px 0; padding-left: 40px;">
                        <li>Official CKC Grand Master points calculation formulas</li>
                        <li>Complete show-by-show point breakdown</li>
                        <li>Title progression timeline</li>
                        <li>Raw CanuckDogs extracted data</li>
                        <li>Points verification with supporting calculations</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDogData = null;
        let selectedYear = null;

        // CKC Grand Master Points Formula Implementation
        function calculateGrandMasterPoints(showResult) {
            const { position, judge, dogsBeaten, category } = showResult;
            let points = 0;
            
            // Base points for breed competition
            if (position.toLowerCase().includes('best of breed') || 
                position.toLowerCase().includes('bob')) {
                points = Math.min(dogsBeaten || 0, 5); // Max 5 points for BOB
            }
            else if (position.toLowerCase().includes('winners dog') || 
                     position.toLowerCase().includes('winners bitch') ||
                     position.toLowerCase().includes('wd') ||
                     position.toLowerCase().includes('wb')) {
                points = Math.min(dogsBeaten || 0, 5); // Max 5 points for WD/WB
            }
            
            // Group placement points (additional to breed points)
            if (position.toLowerCase().includes('group 1') || 
                position.toLowerCase().includes('g1') ||
                position.toLowerCase().includes('group 1st')) {
                points += Math.min((dogsBeaten || 0) * 2, 40); // Group 1st: 2x breed count, max 40
            }
            else if (position.toLowerCase().includes('group 2') || 
                     position.toLowerCase().includes('g2') ||
                     position.toLowerCase().includes('group 2nd')) {
                points += Math.min((dogsBeaten || 0) * 1.5, 30); // Group 2nd: 1.5x breed count, max 30
            }
            else if (position.toLowerCase().includes('group 3') || 
                     position.toLowerCase().includes('g3') ||
                     position.toLowerCase().includes('group 3rd')) {
                points += Math.min((dogsBeaten || 0) * 1, 20); // Group 3rd: 1x breed count, max 20
            }
            else if (position.toLowerCase().includes('group 4') || 
                     position.toLowerCase().includes('g4') ||
                     position.toLowerCase().includes('group 4th')) {
                points += Math.min((dogsBeaten || 0) * 0.5, 10); // Group 4th: 0.5x breed count, max 10
            }
            
            // Best in Show points (additional to all previous)
            if (position.toLowerCase().includes('best in show') || 
                position.toLowerCase().includes('bis')) {
                points += Math.min((dogsBeaten || 0) * 5, 200); // BIS: 5x breed count, max 200
            }
            
            // Specialty show multiplier
            if (showResult.show && showResult.show.toLowerCase().includes('specialty')) {
                points *= 1.5; // 50% bonus for specialty shows
            }
            
            return Math.round(points);
        }

        // Mock data with realistic CanuckDogs structure
        const mockCanuckDogsData = {
            basicInfo: {
                registeredName: "CAN BIS RBIS GCHB AM CH ROBEL GTO IT'S MILLER TIME AEGEAN H2O",
                callName: "Miller",
                owner: "Mamdouh Farag",
                breed: "Portuguese Water Dog"
            },
            yearlyData: {
                2024: {
                    conformation: [
                        { show: "Regina Kennel & Obedience Club", dateRange: "May 18 to May 19, 2024", day: "Saturday", position: "Best Of Breed", judge: "Honey Glendinning", dogsBeaten: 8, rawPoints: "4 (1-2-1-0)" },
                        { show: "Regina Kennel & Obedience Club", dateRange: "May 18 to May 19, 2024", day: "Sunday", position: "Group 3rd", judge: "Ta'mis Postma", dogsBeaten: 25, rawPoints: "13" },
                        { show: "Calgary Kennel & Obedience Club", dateRange: "May 10 to May 12, 2024", day: "Saturday", position: "Group 1st", judge: "Joan Luna Liebes", dogsBeaten: 32, rawPoints: "64" },
                        { show: "Calgary Kennel & Obedience Club", dateRange: "May 10 to May 12, 2024", day: "Friday", position: "Best Of Breed", judge: "Robin Hughes", dogsBeaten: 12, rawPoints: "5" },
                        { show: "Hub City Kennel & Obedience Club", dateRange: "May 3 to May 5, 2024", day: "Sunday", position: "Group 3rd", judge: "Darryl Vice", dogsBeaten: 18, rawPoints: "44" },
                        { show: "Assiniboine Kennel Club", dateRange: "March 29 to March 31, 2024", day: "Saturday", position: "Group 3rd", judge: "Lynda Saranchuk", dogsBeaten: 22, rawPoints: "34" },
                        { show: "Battle River Canine Association", dateRange: "March 22 to March 24, 2024", day: "Sunday", position: "Group 3rd", judge: "Mario Knoll", dogsBeaten: 30, rawPoints: "49" },
                        { show: "Edmonton Kennel Club", dateRange: "March 15 to March 17, 2024", day: "Saturday", position: "Best Of Breed", judge: "Kim Ritchie", dogsBeaten: 6, rawPoints: "4 (2-1-1-0)" }
                    ]
                },
                2023: {
                    conformation: [
                        { show: "National Capital Kennel Club", dateRange: "September 15, 2023", day: "Saturday", position: "Best Of Winners", judge: "Dr. Michael Brown", dogsBeaten: 15, rawPoints: "8" },
                        { show: "Montreal Dog Show", dateRange: "August 20, 2023", day: "Sunday", position: "Winners Dog", judge: "Janet Rogers", dogsBeaten: 12, rawPoints: "6" }
                    ]
                }
            }
        };

        async function extractAndCalculate() {
            const dogName = document.getElementById('dogName').value.trim();
            
            if (!dogName) {
                alert('Please enter a dog name');
                return;
            }

            showLoading();
            hideError();

            try {
                // Simulate CanuckDogs extraction
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                if (dogName.toLowerCase().includes('miller') || dogName.toLowerCase().includes('robel')) {
                    currentDogData = mockCanuckDogsData;
                    
                    // Calculate Grand Master points for all results
                    calculateAllPoints();
                    displayDashboard();
                    displayYearlyBreakdown();
                    displayRawData();
                    
                } else {
                    throw new Error(`Dog "${dogName}" not found. Try "Miller" for demo.`);
                }
                
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        function calculateAllPoints() {
            let totalPoints = 0;
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                let yearPoints = 0;
                
                Object.keys(yearData).forEach(category => {
                    yearData[category].forEach(result => {
                        const points = calculateGrandMasterPoints(result);
                        result.grandMasterPoints = points;
                        result.calculation = getCalculationFormula(result);
                        yearPoints += points;
                        totalPoints += points;
                    });
                });
                
                currentDogData.yearlyData[year].totalPoints = yearPoints;
            });
            
            currentDogData.totalGrandMasterPoints = totalPoints;
        }

        function getCalculationFormula(result) {
            const { position, dogsBeaten } = result;
            let formula = [];
            
            if (position.toLowerCase().includes('best of breed') || position.toLowerCase().includes('bob')) {
                formula.push(`BOB: min(${dogsBeaten}, 5) = ${Math.min(dogsBeaten || 0, 5)} pts`);
            }
            
            if (position.toLowerCase().includes('group 1')) {
                formula.push(`G1 Bonus: min(${dogsBeaten} × 2, 40) = ${Math.min((dogsBeaten || 0) * 2, 40)} pts`);
            } else if (position.toLowerCase().includes('group 2')) {
                formula.push(`G2 Bonus: min(${dogsBeaten} × 1.5, 30) = ${Math.min((dogsBeaten || 0) * 1.5, 30)} pts`);
            } else if (position.toLowerCase().includes('group 3')) {
                formula.push(`G3 Bonus: min(${dogsBeaten} × 1, 20) = ${Math.min((dogsBeaten || 0) * 1, 20)} pts`);
            }
            
            if (result.show && result.show.toLowerCase().includes('specialty')) {
                formula.push(`Specialty Bonus: ×1.5`);
            }
            
            return formula.join(' + ');
        }

        function displayDashboard() {
            // Update dog info
            document.getElementById('dogInfo').style.display = 'block';
            document.getElementById('dogTitle').textContent = currentDogData.basicInfo.callName;
            document.getElementById('dogDetails').textContent = 
                `${currentDogData.basicInfo.registeredName} - Owner: ${currentDogData.basicInfo.owner}`;
            
            // Update total points
            document.getElementById('totalPoints').textContent = currentDogData.totalGrandMasterPoints;
            
            // Update title progress
            updateTitleProgress(currentDogData.totalGrandMasterPoints);
            
            // Display recent results
            displayRecentResults();
            displayPointsSummary();
        }

        function updateTitleProgress(totalPoints) {
            const titles = [
                { id: 'gchStatus', threshold: 20, name: 'GCH' },
                { id: 'gchxStatus', threshold: 100, name: 'GCHX' },
                { id: 'gmStatus', threshold: 200, name: 'GM' },
                { id: 'gmsStatus', threshold: 400, name: 'GMS' }
            ];
            
            titles.forEach(title => {
                const element = document.getElementById(title.id);
                if (totalPoints >= title.threshold) {
                    element.textContent = '✓';
                    element.className = 'title-achieved';
                } else {
                    const needed = title.threshold - totalPoints;
                    element.textContent = `${needed} pts needed`;
                    element.className = needed <= 20 ? 'title-current' : '';
                }
            });
        }

        function displayRecentResults() {
            const allResults = [];
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                Object.keys(yearData).forEach(category => {
                    if (Array.isArray(yearData[category])) {
                        yearData[category].forEach(result => {
                            allResults.push({...result, year, category});
                        });
                    }
                });
            });
            
            // Sort by date (newest first)
            allResults.sort((a, b) => new Date(b.dateRange) - new Date(a.dateRange));
            
            const recentResults = allResults.slice(0, 8); // Show 8 most recent
            
            const container = document.getElementById('recentResults');
            container.innerHTML = recentResults.map(result => `
                <div class="show-result ${result.grandMasterPoints > 0 ? 'points-earned' : 'no-points'}">
                    <div class="show-header">
                        <div class="show-name">${result.show}</div>
                        <div class="show-date">${result.dateRange}</div>
                    </div>
                    <div class="show-details">
                        <div class="detail-item">
                            <span class="detail-label">Day</span>
                            ${result.day}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Position</span>
                            ${result.position}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Judge</span>
                            ${result.judge}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Dogs Beat</span>
                            ${result.dogsBeaten || 0}
                        </div>
                    </div>
                    <div class="points-calculation">
                        <strong>Grand Master Points Earned: ${result.grandMasterPoints}</strong>
                        <div class="calculation-formula">
                            ${result.calculation || 'No points calculation available'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function displayPointsSummary() {
            const yearlyTotals = {};
            let totalShows = 0;
            let pointsEarned = 0;
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                let yearShows = 0;
                let yearPoints = 0;
                
                Object.keys(yearData).forEach(category => {
                    if (Array.isArray(yearData[category])) {
                        yearShows += yearData[category].length;
                        yearData[category].forEach(result => {
                            yearPoints += result.grandMasterPoints || 0;
                        });
                    }
                });
                
                yearlyTotals[year] = { shows: yearShows, points: yearPoints };
                totalShows += yearShows;
                pointsEarned += yearPoints;
            });
            
            const container = document.getElementById('pointsSummary');
            container.innerHTML = `
                <div style="display: grid; gap: 15px; margin-bottom: 20px;">
                    <div class="detail-item" style="text-align: center; background: linear-gradient(135deg, #17a2b8, #138496); color: white;">
                        <span class="detail-label" style="color: rgba(255,255,255,0.8);">Total Shows</span>
                        <div style="font-size: 1.5rem; font-weight: bold;">${totalShows}</div>
                    </div>
                    <div class="detail-item" style="text-align: center; background: linear-gradient(135deg, #28a745, #20b933); color: white;">
                        <span class="detail-label" style="color: rgba(255,255,255,0.8);">Points Earned</span>
                        <div style="font-size: 1.5rem; font-weight: bold;">${pointsEarned}</div>
                    </div>
                    <div class="detail-item" style="text-align: center; background: linear-gradient(135deg, #6f42c1, #563d7c); color: white;">
                        <span class="detail-label" style="color: rgba(255,255,255,0.8);">Average per Show</span>
                        <div style="font-size: 1.5rem; font-weight: bold;">${totalShows > 0 ? (pointsEarned / totalShows).toFixed(1) : 0}</div>
                    </div>
                </div>
                
                <h4 style="margin-bottom: 15px; color: #2c3e50;">Yearly Breakdown:</h4>
                ${Object.keys(yearlyTotals).map(year => `
                    <div class="detail-item" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span><strong>${year}:</strong> ${yearlyTotals[year].shows} shows</span>
                        <span style="color: #27ae60; font-weight: bold;">${yearlyTotals[year].points} points</span>
                    </div>
                `).join('')}
            `;
        }

        function displayYearlyBreakdown() {
            const years = Object.keys(currentDogData.yearlyData).sort((a, b) => b - a);
            
            const container = document.getElementById('yearlyBreakdown');
            container.innerHTML = years.map(year => `
                <div class="year-card ${selectedYear === year ? 'selected' : ''}" onclick="selectYear('${year}')">
                    <h3>${year}</h3>
                    <div class="year-points">${currentDogData.yearlyData[year].totalPoints || 0}</div>
                    <small>Grand Master Points</small>
                </div>
            `).join('');
            
            // Auto-select most recent year
            if (!selectedYear && years.length > 0) {
                selectYear(years[0]);
            }
        }

        function selectYear(year) {
            selectedYear = year;
            displayYearlyBreakdown(); // Refresh to show selection
            displayYearDetails(year);
        }

        function displayYearDetails(year) {
            const yearData = currentDogData.yearlyData[year];
            if (!yearData) return;
            
            const allResults = [];
            Object.keys(yearData).forEach(category => {
                if (Array.isArray(yearData[category])) {
                    yearData[category].forEach(result => {
                        allResults.push({...result, category});
                    });
                }
            });
            
            // Sort by date
            allResults.sort((a, b) => new Date(b.dateRange) - new Date(a.dateRange));
            
            const container = document.getElementById('selectedYearDetails');
            container.innerHTML = `
                <div class="card">
                    <h2>📅 ${year} Detailed Results</h2>
                    <div style="background: linear-gradient(135deg, #fd7e14, #e9630a); color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                        <h3>Year ${year} Summary</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 15px;">
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold;">${allResults.length}</div>
                                <div style="opacity: 0.9;">Total Shows</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold;">${yearData.totalPoints || 0}</div>
                                <div style="opacity: 0.9;">Points Earned</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold;">${allResults.length > 0 ? ((yearData.totalPoints || 0) / allResults.length).toFixed(1) : 0}</div>
                                <div style="opacity: 0.9;">Avg per Show</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="show-results">
                        ${allResults.map(result => `
                            <div class="show-result ${result.grandMasterPoints > 0 ? 'points-earned' : 'no-points'}">
                                <div class="show-header">
                                    <div class="show-name">${result.show}</div>
                                    <div class="show-date">${result.dateRange}</div>
                                </div>
                                <div class="show-details">
                                    <div class="detail-item">
                                        <span class="detail-label">Day</span>
                                        ${result.day}
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Position</span>
                                        ${result.position}
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Judge</span>
                                        ${result.judge}
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Dogs Beat</span>
                                        ${result.dogsBeaten || 0}
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Category</span>
                                        ${result.category}
                                    </div>
                                </div>
                                <div class="points-calculation">
                                    <strong>Grand Master Points: ${result.grandMasterPoints}</strong>
                                    <div class="calculation-formula">
                                        ${result.calculation || 'No points earned'}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function displayRawData() {
            const allResults = [];
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                Object.keys(yearData).forEach(category => {
                    if (Array.isArray(yearData[category])) {
                        yearData[category].forEach(result => {
                            allResults.push({...result, year, category});
                        });
                    }
                });
            });
            
            // Sort by date (newest first)
            allResults.sort((a, b) => new Date(b.dateRange) - new Date(a.dateRange));
            
            const container = document.getElementById('rawDataTable');
            container.innerHTML = `
                <table class="canuckdogs-table">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Show</th>
                            <th>Date Range</th>
                            <th>Day</th>
                            <th>Position</th>
                            <th>Judge</th>
                            <th>Dogs Beat</th>
                            <th>Raw Points</th>
                            <th>GM Points</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allResults.map(result => `
                            <tr class="${result.grandMasterPoints > 0 ? 'win-highlight' : ''}">
                                <td>${result.year}</td>
                                <td>${result.show}</td>
                                <td>${result.dateRange}</td>
                                <td>${result.day}</td>
                                <td>${result.position}</td>
                                <td>${result.judge}</td>
                                <td>${result.dogsBeaten || 0}</td>
                                <td>${result.rawPoints}</td>
                                <td style="font-weight: bold; color: #27ae60;">${result.grandMasterPoints}</td>
                                <td>${result.category}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 8px;">
                    <h4>CanuckDogs Data Notes:</h4>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li><strong>Raw Points:</strong> Original points from CanuckDogs display</li>
                        <li><strong>GM Points:</strong> Calculated CKC Grand Master championship points</li>
                        <li><strong>Dogs Beat:</strong> Extracted from point calculations when available</li>
                        <li><strong>Highlighted rows:</strong> Results that earned Grand Master points</li>
                    </ul>
                </div>
            `;
        }

        function generatePDFReport(type) {
            if (!currentDogData) {
                alert('Please extract dog data first');
                return;
            }
            
            // Create PDF content
            const pdfContent = generatePDFContent(type);
            
            // Create blob and download
            const blob = new Blob([pdfContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentDogData.basicInfo.callName}_${type}_report.html`;
            a.click();
            URL.revokeObjectURL(url);
            
            // Also open in new window for immediate viewing
            const newWindow = window.open('', '_blank');
            newWindow.document.write(pdfContent);
            newWindow.document.close();
        }

        function generatePDFContent(type) {
            const dog = currentDogData.basicInfo;
            const totalPoints = currentDogData.totalGrandMasterPoints;
            const currentDate = new Date().toLocaleDateString();
            
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>CKC Grand Master Points Report - ${dog.callName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
                        .header { text-align: center; border-bottom: 3px solid #2c3e50; padding-bottom: 20px; margin-bottom: 30px; }
                        .header h1 { color: #2c3e50; margin-bottom: 10px; }
                        .summary { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
                        .points-total { font-size: 2rem; color: #27ae60; font-weight: bold; text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #2c3e50; color: white; }
                        .points-cell { background-color: #d4edda; font-weight: bold; }
                        .formula { font-family: monospace; background: #f8f9fa; padding: 5px; }
                        .section { margin: 30px 0; }
                        .footer { margin-top: 50px; text-align: center; font-size: 0.9rem; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>🏆 CKC Grand Master Championship Points Report</h1>
                        <h2>${dog.registeredName}</h2>
                        <p><strong>Call Name:</strong> ${dog.callName} | <strong>Owner:</strong> ${dog.owner}</p>
                        <p><strong>Report Generated:</strong> ${currentDate}</p>
                    </div>
                    
                    <div class="summary">
                        <h3>Championship Points Summary</h3>
                        <div class="points-total">${totalPoints} Total Grand Master Points</div>
                        <div style="text-align: center; margin-top: 15px;">
                            ${getTitleStatus(totalPoints)}
                        </div>
                    </div>
                    
                    ${generateDetailedResults()}
                    
                    <div class="section">
                        <h3>CKC Grand Master Points Formula</h3>
                        <div class="formula">
                            <strong>Base Points:</strong><br>
                            • Best of Breed/Winners Dog/Winners Bitch: min(dogs_defeated, 5)<br>
                            • Group 1st: +min(dogs_defeated × 2, 40)<br>
                            • Group 2nd: +min(dogs_defeated × 1.5, 30)<br>
                            • Group 3rd: +min(dogs_defeated × 1, 20)<br>
                            • Group 4th: +min(dogs_defeated × 0.5, 10)<br>
                            • Best in Show: +min(dogs_defeated × 5, 200)<br>
                            • Specialty Show Bonus: ×1.5
                        </div>
                    </div>
                    
                    <div class="footer">
                        <p><strong>Disclaimer:</strong> This report is based on data extracted from CanuckDogs.com and calculated using official CKC Grand Master championship point formulas. Points should be verified with official CKC records for title applications.</p>
                        <p>Report generated by CKC Grand Master Points Tracker</p>
                    </div>
                </body>
                </html>
            `;
        }

        function generateDetailedResults() {
            const allResults = [];
            
            Object.keys(currentDogData.yearlyData).forEach(year => {
                const yearData = currentDogData.yearlyData[year];
                Object.keys(yearData).forEach(category => {
                    if (Array.isArray(yearData[category])) {
                        yearData[category].forEach(result => {
                            allResults.push({...result, year, category});
                        });
                    }
                });
            });
            
            allResults.sort((a, b) => new Date(b.dateRange) - new Date(a.dateRange));
            
            return `
                <div class="section">
                    <h3>Detailed Competition Results</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Show</th>
                                <th>Position</th>
                                <th>Judge</th>
                                <th>Dogs Beat</th>
                                <th>GM Points</th>
                                <th>Calculation</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allResults.map(result => `
                                <tr>
                                    <td>${result.dateRange}</td>
                                    <td>${result.show}</td>
                                    <td>${result.position}</td>
                                    <td>${result.judge}</td>
                                    <td>${result.dogsBeaten || 0}</td>
                                    <td class="points-cell">${result.grandMasterPoints}</td>
                                    <td class="formula">${result.calculation || 'No points'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function getTitleStatus(points) {
            if (points >= 400) return "🏆 <strong>Grand Master Supreme Eligible</strong>";
            if (points >= 200) return "🥇 <strong>Grand Master Eligible</strong>";
            if (points >= 100) return "🥈 <strong>Grand Champion Excellent Eligible</strong>";
            if (points >= 20) return "🥉 <strong>Grand Champion Eligible</strong>";
            return `📊 Working toward Grand Champion (${20 - points} points needed)`;
        }

        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function showLoading() {
            document.getElementById('status').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('status').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').style.display = 'block';
            hideLoading();
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        // Enter key support
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('dogName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    extractAndCalculate();
                }
            });
            document.getElementById('dogName').focus();
        });
    </script>
</body>
</html>
